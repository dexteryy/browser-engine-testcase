
<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>固定列宽（column-width）测试</title>
<link rel="stylesheet" href="style.css" />
<script defer src="utils.js"></script>
</head>
<body>
  <header id="topbar">
    <h1>固定列宽（column-width）测试</h1>
    <p>关注：根据列宽自动计算列数的布局表现，以及容器宽度变化时的重排与性能。</p>
  </header>

  <section id="toolbar" class="container">
    <div class="toolbar">
      <div class="control" style="grid-column: span 3;">
        <label>容器宽度：<output id="cwOut"></output></label>
        <input id="cw" type="range" min="600" max="1400" value="1100" />
      </div>
      <div class="control" style="grid-column: span 3;">
        <label>列宽（column-width）：<output id="colwOut"></output></label>
        <input id="colw" type="range" min="140" max="360" value="220" />
      </div>
      <div class="control" style="grid-column: span 3;">
        <label>列间距（column-gap）：<output id="gapOut"></output></label>
        <input id="gap" type="range" min="0" max="48" value="24" />
      </div>
      <div class="control" style="grid-column: span 3;">
        <label>最多列数上限（可选）</label>
        <input id="maxCount" type="number" min="1" max="12" value="6" />
      </div>
      <div class="control" style="grid-column: span 3;">
        <label>列分隔线宽度：<output id="ruleWOut"></output></label>
        <input id="ruleW" type="range" min="0" max="6" value="1" />
      </div>
      <div class="control" style="grid-column: span 3;">
        <label>列分隔线样式</label>
        <select id="ruleStyle">
          <option value="none">none</option>
          <option value="solid" selected>solid</option>
          <option value="dashed">dashed</option>
          <option value="dotted">dotted</option>
        </select>
      </div>
      <div class="control" style="grid-column: span 3;">
        <label>列分隔线颜色</label>
        <input id="ruleColor" type="color" value="#dddddd" />
      </div>
      <div class="control" style="grid-column: span 12;">
        <div id="metrics" class="meta"></div>
      </div>
    </div>
  </section>

  <main id="test-area" class="container">
    <div class="test-card">
      <div id="mc" class="columns" style="column-width:220px; column-gap:24px; column-fill:balance; column-rule:1px solid #ddd;">
        <!-- Content injected by JS -->
      </div>
    </div>
  </main>

  <section id="explain" class="container">
    <h2>测试说明</h2>
    <ul>
      <li>通过调整容器宽度和列宽，观察实际列数的变化（近似计算规则见工具栏下方徽章）。</li>
      <li>可设置最多列数上限（即同时设置 <code>column-count</code>），用于测试“列宽 + 列数上限”的组合行为。</li>
      <li>改变列分隔线与间距，检查重排时是否稳定、无错位。</li>
    </ul>
  </section>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const mc = $("#mc");
      const cw = $("#cw"); const cwOut = $("#cwOut");
      const colw = $("#colw"); const colwOut = $("#colwOut");
      const gap = $("#gap"); const gapOut = $("#gapOut");
      const maxCount = $("#maxCount");
      const ruleW = $("#ruleW"); const ruleWOut = $("#ruleWOut");
      const ruleStyle = $("#ruleStyle");
      const ruleColor = $("#ruleColor");
      const metrics = $("#metrics");

      bindRangeOutput(cw, cwOut, v => v + " px");
      bindRangeOutput(colw, colwOut, v => v + " px");
      bindRangeOutput(gap, gapOut);
      bindRangeOutput(ruleW, ruleWOut);

      // Content
      fillContent(mc, { paragraphs: 40, withSpanningHeader: true });

      const apply = () => {
        mc.parentElement.style.width = cw.value + "px"; // test-card inner width
        mc.style.columnWidth = colw.value + "px";
        mc.style.columnGap = gap.value + "px";
        mc.style.columnRule = `${ruleW.value}px ${ruleStyle.value} ${ruleColor.value}`;
        // Optional count cap
        const cap = parseInt(maxCount.value || "0", 10);
        if (cap > 0) mc.style.columnCount = cap;
        else mc.style.removeProperty("column-count");

        renderMetrics(mc, metrics);

        // Show expected count formula in badges
        const cs = getComputedStyle(mc);
        const width = mc.clientWidth;
        const gapPx = parseFloat(cs.columnGap);
        const colwPx = parseFloat(colw.value);
        const expected = Math.max(1, Math.floor((width + gapPx) / (colwPx + gapPx)));
        const capped = cap > 0 ? Math.min(cap, expected) : expected;
        const extra = document.createElement("span");
        extra.className = "badge";
        extra.textContent = `预估列数（列宽推导）：${expected}（上限后：${capped}）`;
        metrics.appendChild(extra);
      };

      apply();
      [cw, colw, gap, ruleW, ruleStyle, ruleColor, maxCount].forEach(i => i.addEventListener("input", apply));
      window.addEventListener("resize", apply);
    });
  </script>
</body>
</html>
