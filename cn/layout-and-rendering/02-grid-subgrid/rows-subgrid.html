
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>测试用例2B：行方向 Subgrid 对齐</title>
  <link rel="stylesheet" href="assets/style.css"/>
  <style>
    /* ========== Page 2B specific styles ========== */
    .grid-root.rows-demo {
      /* Provide explicit rows (with fr) and a fixed test height so track sizes are stable. */
      --rows: [header-start] 72px
              [header-end band-start] 1fr
              [band-mid] 2fr
              [band-end footer-start] 72px
              [footer-end];
      grid-template-rows: var(--rows);
      grid-template-columns: [left] 1fr [right] 1fr; /* simple two columns for layout */
      height: 560px; /* fixed height to make row frs measurable */
    }
    .header  { grid-column: left / right; grid-row: header-start / header-end; background: #f8fafc; }
    .footer  { grid-column: left / right; grid-row: footer-start / footer-end; }

    /* Subgrid box spanning the two flexible rows */
    .stack {
      grid-column: left / right;
      grid-row: band-start / band-end; /* spans 1fr + 2fr area */
      display: grid;
      grid-template-rows: subgrid;  /* inherit the rows from parent */
      gap: var(--gap);
      border: 1px dashed #86efac;
      background: #f6fff7;
      padding: 8px;
    }
    .row-card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 8px 10px;
    }
    /* Place row items using both names and numeric indices */
    .row-card.r1 { grid-row: band-start / band-mid; }
    .row-card.r2 { grid-row: band-mid / band-end; }
    .row-card.r3 { grid-row: 1 / -1; } /* spans entire subgrid rows */
  </style>
</head>
<body>
  <header class="topbar">
    <div class="inner">
      <div style="display:flex;justify-content:space-between;gap:12px;align-items:baseline;">
        <div>
          <h1>测试用例2B：行方向 Subgrid 对齐</h1>
          <p>验证子网格在<strong>行方向</strong>继承父网格轨道，跨多行区域保持边界对齐。</p>
        </div>
        <div class="note" id="support-note">浏览器支持：检测中…</div>
      </div>
      <div class="pages">
        页面导航：
        <a href="./index.html">2A 列</a> ·
        <a href="./rows-subgrid.html">2B 行</a> ·
        <a href="./both-axes.html">2C 双轴</a>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="toolbar">
      <div class="tool">
        <label for="gap">间隙（gap）：</label>
        <input id="gap" type="range" min="0" max="40" step="1" value="16" />
        <span class="value" id="gap-val">16px</span>
      </div>
      <div class="tool">
        <input id="show-parent-rows" type="checkbox" />
        <label for="show-parent-rows">显示父网格行线</label>
      </div>
      <div class="tool">
        <input id="show-sub-rows" type="checkbox" />
        <label for="show-sub-rows">显示子网格行线</label>
      </div>
      <div class="tool">
        <button class="btn" id="measure">测量一次重排耗时</button>
        <span class="value" id="time">–</span>
      </div>
    </section>

    <section class="test-area">
      <div class="grid-root rows-demo" id="root">
        <div class="grid-item header"><strong>页眉</strong>（固定高 72px）</div>

        <div class="panel stack" id="stack">
          <div class="row-card r1"><strong>行卡片 1</strong>：使用命名行 <code>band-start / band-mid</code> 对齐。</div>
          <div class="row-card r2"><strong>行卡片 2</strong>：使用命名行 <code>band-mid / band-end</code> 对齐。</div>
          <div class="row-card r3"><strong>行卡片 3</strong>：使用数字 <code>1 / -1</code> 跨越整个子网格。</div>
        </div>

        <div class="grid-item footer"><strong>页脚</strong>（固定高 72px）</div>
      </div>
      <p class="note">说明：本页固定父网格高度以便 <code>fr</code> 行能分配空间，便于观察行方向子网格的对齐。</p>
    </section>

    <section class="explain">
      <h2>解释说明</h2>
      <div class="kv">
        <div>测试目标</div>
        <div>验证 Chrome 对 CSS Subgrid 在<strong>行方向</strong>的继承与对齐，子网格内部元素应与父网格的行线重合。</div>

        <div>测试方案</div>
        <div>父网格定义 4 条显式行轨道：固定（header/footer）与 <code>1fr/2fr</code> 的弹性区域；中部区域由子网格 <code>.stack</code> 跨越并使用 <code>grid-template-rows: subgrid</code>，内部元素以命名行或数字索引对齐。</div>

        <div>使用方法</div>
        <div>1) 勾选“显示父网格行线/子网格行线”；2) 调整 gap；3) 观察中部区域的子项在两个弹性行间的对齐是否准确；4) 通过“测量一次重排耗时”粗略评估在改变 gap 时的重排耗时。</div>

        <div>评估结果</div>
        <div>正常情况下：子网格行线与父网格对应行线重合；内部卡片的上/下边应落在子网格行线位置；改变 gap 或尺寸时保持一致。</div>
      </div>
    </section>
  </main>

  <script src="assets/app.js"></script>
  <script>
    const { $, GridOverlay, supportsSubgrid, bindGap, measureReflow } = window.GridHarness;
    const root = $('#root');
    const stack = $('#stack');

    // Feature detection
    const ok = supportsSubgrid();
    $('#support-note').textContent = ok ? '浏览器支持：Subgrid ✓' : '浏览器支持：Subgrid ✗（本页功能受限）';
    $('#support-note').style.color = ok ? '#0a7f49' : '#c12a2a';

    bindGap($('#gap'), root, $('#gap-val'));

    // Overlays for rows
    const ovParentRows = new GridOverlay(root, 'rows');
    const ovChildRows = new GridOverlay(stack, 'rows', { useSubgrid: true });
    ovParentRows.setEnabled(false);
    ovChildRows.setEnabled(false);

    $('#show-parent-rows').addEventListener('change', e => ovParentRows.setEnabled(e.target.checked));
    $('#show-sub-rows').addEventListener('change', e => ovChildRows.setEnabled(e.target.checked));

    // Simple reflow timing: change root height slightly and restore
    const measureBtn = $('#measure');
    measureBtn.addEventListener('click', async () => {
      const prev = root.style.height || '560px';
      const prevNum = parseFloat(prev);
      const ms = await measureReflow(() => {
        root.style.height = (prevNum + 10) + 'px';
      }, root);
      $('#time').textContent = ms.toFixed(2) + ' ms';
      root.style.height = prev;
    });
  </script>
</body>
</html>
